<!DOCTYPE html>
<html lang="zh">
<head>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cactus+Classical+Serif&family=Noto+Sans+HK:wght@100..900&family=Noto+Serif+TC:wght@200..900&display=swap" rel="stylesheet">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="static/css/index.css" rel="stylesheet" />
    <link href="static/css/notification.css" rel="stylesheet" />
    <title>ä»£åšèœåª’åˆå¹³å°</title>
</head>
<body>
    <div class="navbar">
        <div class="site-name">å‘³ä½ è€Œç…®</div>
        <div class="nav-links">
            <a href="{{ url_for('index') }}">é¦–é </a>
            {% if user %}
            <a href="CookingMethod.html">æ–™ç†æ–¹å¼å»ºè­°</a>
            <a href="{{ url_for('order_step0') }}">æ–°å¢è¨‚å–®</a>
            <a href="{{ url_for('customer_order_list') }}">æˆ‘çš„è¨‚å–®</a>
            <a href="#" onclick="toggleNotification(); return false;">é€šçŸ¥ä¸­å¿ƒ</a>
            {% else %}
            <a href="{{ url_for('index') }}">é—œæ–¼æˆ‘å€‘</a>
            <a href="{{ url_for('index') }}">æ–™ç†æ–¹å¼å»ºè­°</a>
            <a href="{{ url_for('index') }}">å¸¸è¦‹å•é¡Œ</a>
            {% endif %}
        </div>
        <div class="user-info">
            {% if user %}
            <img
                src="{{ avatar_url }}"
                alt="é ­åƒ"
                class="avatar"
            />
            <div class="user-text">
                <div class="name">{{ user.name }}</div>
                <div class="email">{{ user.email }}</div>
            </div>
            
            <div class="settings-icon" onclick="toggleSettingsModal()"></div>
            {% else %}
            <a href="{{ url_for('login') }}">ç™»å…¥/è¨»å†Š</a>
            {% endif %}
        </div>
    </div>
    <div class="content">
        <h1>æ­¡è¿ä¾†åˆ°æˆ‘å€‘çš„ç¶²ç«™</h1>
        <p>é€™æ˜¯ä¸€å€‹ä»£åšèœçš„åª’åˆå¹³å°ã€‚</p>
    </div>
    <div class="content">
        <div class="section">
            <h3>å¹³å°ç°¡ä»‹</h3>
            <p>
                å¹³å°æ—¨åœ¨ç‚ºå¿™ç¢Œçš„ç¾ä»£äººæä¾›ä¾¿æ·çš„é¤é£Ÿè§£æ±ºæ–¹æ¡ˆã€‚ç„¡è«–æ˜¯å› å·¥ä½œç¹å¿™ã€èšæœƒéœ€è¦ï¼Œæˆ–æ˜¯å–®ç´”æƒ³äº«å—å®¶å¸¸ç¾å‘³å»ç„¡æš‡ä¸‹å»šï¼Œå¹³å°éƒ½èƒ½å¹«åŠ©ç”¨æˆ¶å¿«é€Ÿæ‰¾åˆ°åˆé©çš„ä»£åšèœæœå‹™ã€‚
                <br><br>
                ä½¿ç”¨è€…åªéœ€é€éç°¡å–®çš„æ“ä½œï¼Œå³å¯ç€è¦½å¤šæ¨£èœå–®ã€é ç´„ä»£åšèœæœå‹™ï¼Œä¸¦é¸æ“‡è‡ªå–æˆ–å¤–é€ã€‚å¹³å°åŒæ™‚æä¾›ä»£åšèœå¸«å‚…è³‡è¨Šèˆ‡è©•åƒ¹ï¼Œä¿éšœç”¨æˆ¶çš„é¸æ“‡å“è³ªèˆ‡é¤é£Ÿå®‰å…¨ã€‚
                <br><br>
                æˆ‘å€‘è‡´åŠ›æ–¼æ‰“é€ ä¸€å€‹ <strong>æ–¹ä¾¿ã€å¿«é€Ÿã€å®‰å…¨</strong> çš„ç”¨é¤åª’åˆé«”é©—ï¼Œè®“æ¯ä¸€ä½ç”¨æˆ¶éƒ½èƒ½è¼•é¬†äº«å—ç¾å‘³æ–™ç†ï¼Œæ¸›å°‘ç”Ÿæ´»ç…©æƒ±ã€‚
            </p>
        </div>
        <div class="section">
            <h3>æµç¨‹ä»‹ç´¹</h3>
            <p>1. é¸æ“‡è§’è‰²ï¼ˆå»šå¸« / é¡§å®¢ï¼‰</p>
            <p>2. ç€è¦½æˆ–ä¸Šæ¶èœå–®</p>
            <p>3. ä¸‹å–®æˆ–æ¥å–®</p>
            <p>4. å®Œæˆè¨‚å–®ä¸¦ç•™ä¸‹è©•åƒ¹</p>
        </div>
        <div class="section">
            <h3>æœ€æ–°å…¬å‘Š</h3>
            <p>æ˜¥ç¯€æœŸé–“è¨‚å–®èª¿æ•´æ™‚é–“è«‹æå‰æŸ¥è©¢ï¼</p>
        </div>
    </div>

    <div class="footer">
        Â© 2025 ç¶²ç«™åç¨±. All rights reserved.<br>
        è¯çµ¡æˆ‘å€‘ï¼šofficial@example.comÂ | é›»è©±ï¼š02-12345678900
    </div>

     <!-- è¨­å®šå°è¦–çª— -->
     <div class="settings-modal" id="settings-modal">
        <div class="modal-content">
            <h2 class="title">è¨­å®š</h2>

            <!-- å¸³è™Ÿå€å¡Š -->
            <div class="section2">
                <h3>å¸³è™Ÿ</h3>
                <div class="account-info">
                    <img src="{{ avatar_url }}" alt="Avatar" class="avatar">
                    <div class="account-text">
                        <p class="name">{{ user.name }}</p>
                        <p class="sub-text">å€‹äººè³‡æ–™</p>
                    </div>
                    <button class="arrow-btn" onclick="toggleProfileModal()">âœ</button>
                </div>
            </div>

            <!-- å…¶ä»– -->
            <div class="section2">
                <h3>å…¶ä»–</h3>
                <form action="{{ url_for('logout') }}" method="get" style="display:inline">
                <button class="logout-btn">
                    <span>â†©ï¸ ç™»å‡º</span>
                </button>
                </form>
                <!-- <button class="delete-btn">
                    ğŸ—‘ï¸ åˆªé™¤å¸³è™Ÿ
                </button> -->
            </div>
        </div>
    </div>
    <!-- ç¬¬äºŒå€‹å€‹äººè³‡æ–™è¦–çª— -->
    <div class="settings-modal" id="profile-modal">
        <div class="modal-content profile-content">
            <h2 class="title">å€‹äººè³‡æ–™ç·¨è¼¯</h2>

            <form id="profile-form" enctype="multipart/form-data">
                <div class="profile-container">
                    <!-- é ­åƒå€å¡Š -->
                    <div class="avatar-section">
                        <img id="profile-avatar" class="profile-avatar" src="{{ avatar_url }}" alt="å€‹äººé ­åƒ">
                        <input type="file" id="avatar-input" name="avatar" accept="image/*" style="display: none;">
                        <button type="button" class="edit-avatar-btn">å€‹äººé ­åƒç·¨è¼¯</button>
                    </div>

                    <!-- è¼¸å…¥è¡¨å–® -->
                    <div class="form-section">
                        <label>å§“åï¼š</label> 
                        <input type="text" name="name" placeholder="è«‹è¼¸å…¥å§“å" value="{{ user.name }}" required>
                        
                        <label>é›»å­éƒµä»¶ï¼š</label> 
                        <input type="email" placeholder="è«‹è¼¸å…¥é›»å­éƒµä»¶" value="{{ user.email }}" readonly style="background-color: #f0f0f0;">
                        
                        <label>é›»è©±ï¼š</label> 
                        <input type="tel" name="phone" placeholder="è«‹è¼¸å…¥é›»è©±" value="{{ user.phone or '' }}">
                        
                        <label>ç›®å‰å¯†ç¢¼ï¼š</label> 
                        <input type="password" name="current_password" placeholder="ä¿®æ”¹å¯†ç¢¼æ™‚è«‹è¼¸å…¥ç›®å‰å¯†ç¢¼">
                        
                        <label>æ–°å¯†ç¢¼ï¼š</label> 
                        <input type="password" name="new_password" placeholder="è«‹è¼¸å…¥æ–°å¯†ç¢¼ï¼ˆä¸ä¿®æ”¹è«‹ç•™ç©ºï¼‰">
                    </div>
                </div>

                <!-- å„²å­˜æŒ‰éˆ• -->
                <button type="submit" class="save-btn">å„²å­˜è®Šæ›´</button>
                <button type="button" class="close-btn" onclick="toggleProfileModal()">è¿”å›</button>
            </form>
        </div>
    </div>

    <!-- é€šçŸ¥ä¸­å¿ƒè¦–çª— -->
    <div class="notification-center" id="notificationCenter">
        <div class="notification-header">
            <span>é€šçŸ¥ä¸­å¿ƒ</span>
            <button class="clear-all" onclick="clearAllNotifications()">æ¸…ç©ºé€šçŸ¥</button>
        </div>
        <ul class="notification-list" id="notificationList">
            <!-- é€šçŸ¥é …ç›®æœƒå‹•æ…‹æ·»åŠ åœ¨é€™è£¡ -->
        </ul>
    </div>

    <script>
        // åˆ‡æ›è¨­å®šè¦–çª—
        function toggleSettingsModal() {
            const modal = document.getElementById('settings-modal');

            if (modal.classList.contains('show')) {
                modal.classList.remove('show');
                setTimeout(() => {
                    modal.style.display = 'none';
                }, 300); // ç­‰å‹•ç•«çµæŸå†éš±è—
            } else {
                modal.style.display = 'flex';
                setTimeout(() => {
                    modal.classList.add('show');
                }, 10);
            }
        }

        // åˆ‡æ›å€‹äººè³‡æ–™è¦–çª—
        function toggleProfileModal() {
            const profileModal = document.getElementById('profile-modal');

            if (profileModal.classList.contains('show')) {
                profileModal.classList.remove('show');
                setTimeout(() => {
                    profileModal.style.display = 'none';
                }, 300);
            } else {
                profileModal.style.display = 'flex';
                setTimeout(() => {
                    profileModal.classList.add('show');
                }, 10);
            }
        }

        // é»æ“Šè¦–çª—å¤–éƒ¨é—œé–‰
        window.onclick = function (event) {
            const settingsModal = document.getElementById('settings-modal');
            const profileModal = document.getElementById('profile-modal');

            // å¦‚æœé»æ“Šçš„ç›®æ¨™æ˜¯ `settingsModal` æœ¬èº«ï¼Œå‰‡é—œé–‰å®ƒ
            if (event.target === settingsModal) {
                toggleSettingsModal();
            }

            // å¦‚æœé»æ“Šçš„ç›®æ¨™æ˜¯ `profileModal` æœ¬èº«ï¼Œå‰‡é—œé–‰å®ƒ
            if (event.target === profileModal) {
                toggleProfileModal();
            }
        };

        // è™•ç†é ­åƒä¸Šå‚³
        document.addEventListener("DOMContentLoaded", function () {
            const avatarInput = document.getElementById("avatar-input");
            const profileAvatar = document.getElementById("profile-avatar");
            const editAvatarBtn = document.querySelector(".edit-avatar-btn");
            const profileForm = document.getElementById("profile-form");

            // é»æ“ŠæŒ‰éˆ•æ™‚ï¼Œæ‰“é–‹æ–‡ä»¶é¸æ“‡è¦–çª—
            if (editAvatarBtn) {
                editAvatarBtn.addEventListener("click", function () {
                    avatarInput.click();
                });
            }

            // ç•¶ç”¨æˆ¶é¸æ“‡åœ–ç‰‡æ™‚ï¼Œé è¦½åœ–ç‰‡
            if (avatarInput) {
                avatarInput.addEventListener("change", function (event) {
                    const file = event.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function (e) {
                            profileAvatar.src = e.target.result;
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }

            // è™•ç†è¡¨å–®æäº¤
            if (profileForm) {
                profileForm.addEventListener("submit", async function (event) {
                    event.preventDefault();
                    
                    const formData = new FormData(profileForm);
                    
                    try {
                        const response = await fetch('/customer/profile/update', {
                            method: 'POST',
                            body: formData
                        });
                        
                        const result = await response.json();
                        
                        if (result.success) {
                            alert('å€‹äººè³‡æ–™æ›´æ–°æˆåŠŸï¼');
                            // é‡æ–°è¼‰å…¥é é¢ä»¥é¡¯ç¤ºæ›´æ–°å¾Œçš„è³‡æ–™
                            location.reload();
                        } else {
                            alert('æ›´æ–°å¤±æ•—ï¼š' + result.message);
                        }
                    } catch (error) {
                        console.error('Error:', error);
                        alert('æ›´æ–°å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚');
                    }
                });
            }
        });
    </script>
    <script src="static/js/notification.js"></script>
</body>
</html>
