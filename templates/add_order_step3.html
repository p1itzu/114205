<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cactus+Classical+Serif&family=Noto+Sans+HK:wght@100..900&family=Noto+Serif+TC:wght@200..900&display=swap" rel="stylesheet">
    <link href="/static/css/reserve3.css" rel="stylesheet" />
    <link href="/static/css/notification.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <title>Step3 - 總菜單確認</title>
</head>

<body>
    <div class="navbar">
        <div class="site-name">味你而煮</div>
        <div class="nav-links">
            <a href="{{ url_for('index') }}">首頁</a>
            {% if user %}
            <a href="CookingMethod.html">料理方式建議</a>
            <a href="{{ url_for('order_step1') }}">新增訂單</a>
            <a href="{{ url_for('customer_order_list') }}">我的訂單</a>
            <a href="#" onclick="toggleNotification(); return false;">通知中心</a>
            {% else %}
            <a href="{{ url_for('index') }}">關於我們</a>
            <a href="{{ url_for('index') }}">料理方式建議</a>
            <a href="{{ url_for('index') }}">常見問題</a>
            {% endif %}
        </div>
        <div class="user-info">
            {% if user %}
            <img
                src="{{ avatar_url }}"
                alt="頭像"
                class="avatar"
            />
            <div class="user-text">
                <div class="name">{{ user.name }}</div>
                <div class="email">{{ user.email }}</div>
            </div>
            
            <div class="settings-icon" onclick="toggleSettingsModal()"></div>
            {% else %}
            <a href="{{ url_for('login') }}">登入/註冊</a>
            {% endif %}
        </div>
    </div>

    <!-- 通知中心視窗 -->
    <div class="notification-center" id="notificationCenter">
        <div class="notification-header">
            <span>通知中心</span>
            <button class="clear-all" onclick="clearAllNotifications()">清空通知</button>
        </div>
        <ul class="notification-list" id="notificationList">
        </ul>
    </div>

    <div class="content">
        <div class="section">
            <h3>Step3 - 總菜單確認</h3>

            <form method="post" action="{{ url_for('order_step3') }}">
                <div class="meal-container">
                    <ul class="meal-list" id="mealList">
                        {% for d in dishes %}
                        <li>
                            {{ d.dish_name }} × {{ d.quantity }}
                            <button type="button" class="edit-btn" onclick="location.href='/customer/orders/new/step2';">修改</button>
                            <!-- <button type="button" class="delete-btn">刪除</button> -->
                        </li>
                        {% endfor %}
                    </ul>
                </div>

                <div class="form-buttons" style="display: flex; justify-content: flex-end; gap: 10px;">
                    <button type="button" class="next-button" onclick="location.href='/customer/orders/new/step2';">上一步</button>
                    <button type="submit" class="save-button">確認</button>
                </div>
            </form>
        </div>
    </div>

    <div class="progress-bar">
        <div class="step">第1步</div>
        <div class="line"></div>
        <div class="step">第2步</div>
        <div class="line"></div>
        <div class="step active">第3步</div>
        <div class="line"></div>
        <div class="step">第4步</div>
    </div>

    <!-- 設定小視窗 -->
    <div class="settings-modal" id="settings-modal">
        <div class="modal-content">
            <h2>設定</h2>
            <p>帳號：{{ user.email }}</p>
            <p>其他</p>
            <button class="close-btn" onclick="toggleSettingsModal()">儲存</button>
        </div>
    </div>

    <script>
        function toggleSettingsModal() {
            const modal = document.getElementById('settings-modal');
            modal.style.display = modal.style.display === 'flex' ? 'none' : 'flex';
        }

        // 事件委派，給動態删除按鈕綁定事件
        document.addEventListener('DOMContentLoaded', () => {
            const mealList = document.getElementById('mealList');
            mealList.addEventListener('click', e => {
                if (e.target && e.target.classList.contains('delete-btn')) {
                    const li = e.target.closest('li');
                    Swal.fire({
                        title: '確定刪除?',
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonText: '確定',
                        cancelButtonText: '取消',
                        customClass: {
                            confirmButton: 'swal-custom-button',
                            cancelButton: 'swal-custom-cancel-button'
                        }
                    }).then(result => {
                        if (result.isConfirmed) {
                            li.remove();
                        }
                    });
                }
            });
        });

        function clearAllNotifications() {
            const list = document.getElementById('notificationList');
            list.innerHTML = '';
        }
    </script>
    <script src="/static/js/notification.js"></script>
</body>

</html>
